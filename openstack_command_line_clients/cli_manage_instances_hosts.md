### 管理实例和主机

“实例”，是运行在云中物理主机上的虚拟机。Compute服务管理着众多的实例。“主机”是一组实例栖身的物理节点。

本章介绍了实例管理中的各种不同的任务，比如添加浮动IP，关闭和启动实例，以及删除实例等等。本节也介绍了一些物理节点的管理任务。

#### 管理IP地址

每个实例都有一个内网的固定IP，不过还可以为其添加一个对外的IP，或者叫“浮动IP”。内网IP是用来和其他实例间通信的，而公网是用来和外网的云设施通信的，而且也经常用来和互联网上的设备通信。

当您创建了一个实例，OpenStack会自动为其分配一个内网IP，这个地址一直会保持不变，直到您将该实例销毁。您重启实例也不会影响这个内网IP。

浮动IP资源池则是由云管理员设置的，该服务在OpenStack Compute中可用。每个Project的资源配额决定了您能在这个Project分配的浮动IP的最大数量。在您给某个实例分配了一个浮动IP之后，您能够：

- 将该浮动IP地址和Project中的这个实例相关联。但是，一个浮动IP，同一时间内只能分配给一个实例。
- 将该浮动IP从实例上解除关联。
- 从Project中删除浮动IP，并且连带删除该IP的各种关联。

您可以使用`nova floating-ip-*`命令来管理浮动IP地址。

##### 列出浮动IP信息

列出所有的浮动IP资源池，请使用如下命令：

```
$ nova floating-ip-pool-list
+--------+
| name   |
+--------+
| public |
| test   |
+--------+
```

>注意：
>如果这个列表里没有东西，云管理员必须先创建一个浮动IP资源池。

想列出分配给当前Project的所有浮动IP地址，请使用如下命令：

```
$ nova floating-ip-list
+--------------+--------------------------------------+----------+--------+
| Ip           | Instance Id                          | Fixed Ip | Pool   |
+--------------+--------------------------------------+----------+--------+
| 172.24.4.225 | 4a60ff6a-7a3c-49d7-9515-86ae501044c6 | 10.0.0.2 | public |
| 172.24.4.226 | None                                 | None     | public |
+--------------+--------------------------------------+----------+--------+
```

对于每个分配给当前Project的浮动IP，上面的这个命令能返回以下四个结果：该浮动IP地址，该浮动IP关联的实例的ID，关联的固定IP地址，以及这个浮动IP地址的来源池。

##### 分配浮动IP

您可以将浮动IP分配给Project，也可以分配给instance。

1. 运行如下命令，将一个浮动IP分配给当前Project。默认情况下，该浮动IP是从公共的资源池而来的。该命令的返回结果中会显示本次分配的地址。

```
$ nova floating-ip-create
+--------------+-------------+----------+--------+
| Ip           | Instance Id | Fixed Ip | Pool   |
+--------------+-------------+----------+--------+
| 172.24.4.225 | None        | None     | public |
+--------------+-------------+----------+--------+
```

>注意：
>如果IP地址资源池不止有一个，您可以将资源池名称作为参数传递给该命令，来制定要使用哪一个资源池。比如，要从`test`池中抽取IP地址，请使用如下命令：
>```
>$ nova floating-ip-create test
>```

2. 列出该Project下所有可以关联浮动IP地址的实例：

```
$ nova list
+---------------------+------+---------+------------+-------------+------------------+
| ID                  | Name | Status  | Task State | Power State | Networks         |
+---------------------+------+---------+------------+-------------+------------------+
| d5c854f9-d3e5-4f... | VM1  | ACTIVE  | -          | Running     | private=10.0.0.3 |
| 42290b01-0968-43... | VM2  | SHUTOFF | -          | Shutdown    | private=10.0.0.4 |
+---------------------+------+---------+------------+-------------+------------------+
```

3. 用如下命令，将IP地址和实例相关联：

```
$ nova floating-ip-associate INSTANCE_NAME_OR_ID FLOATING_IP_ADDRESS
```

比如像下面这样：

```
$ nova floating-ip-associate VM1 172.24.4.225
```

此时，该实例便已经和两个IP地址绑定了。

```
$ nova list
+------------------+------+--------+------------+-------------+-------------------------------+
| ID               | Name | Status | Task State | Power State | Networks                      |
+------------------+------+--------+------------+-------------+-------------------------------+
| d5c854f9-d3e5... | VM1  | ACTIVE | -          | Running     | private=10.0.0.3, 172.24.4.225|
| 42290b01-0968... | VM2  | SHUTOFF| -          | Shutdown    | private=10.0.0.4              |
+------------------+------+--------+------------+-------------+-------------------------------+
```

您在关联了该IP地址，且为实例配置了安全组规则之后，该实例便能通过浮动IP来访问了。

>注意：
>如果某个实例连接了多个网络，用`--fixed-address`即可将浮动IP和一个固定IP关联。
>```
>$ nova floating-ip-associate --fixed-address FIXED_IP_ADDRESS \
>  INSTANCE_NAME_OR_ID FLOATING_IP_ADDRESS
>```

##### 回收浮动IP

若要解除浮动IP和实例的关联，请使用如下命令：

```
$ nova floating-ip-disassociate INSTANCE_NAME_OR_ID FLOATING_IP_ADDRESS
```

若要解除浮动IP和Project，请使用如下命令：

```
$ nova floating-ip-delete FLOATING_IP_ADDRESS
```

此时，该IP地址会回归地址资源池，可以被所有Project使用。如果您直接将某一个浮动IP和Project解除了关联，且正挂在某个运行的实例上时，该IP同样会被自动收回。
#### 调整服务器大小

#### 关闭和开启实例

##### 暂停和恢复实例

##### 停用和恢复实例

##### 雪藏和恢复实例

#### 通过IP地址查找实例

#### 重启实例

#### 删除实例

#### 通过控制台连接实例

#### 管理bare-metal节点

##### 常用指令

##### 创建一个bare-metal节点

##### 在该节点上添加网卡口

##### 从一份bare-metal镜像创建实例

##### 列出bare-metal节点和接口

##### 查看bare-metal节点的详细信息